<!doctype html>
<html>
<head>
  <title>Basic tests</title>
  <link rel="stylesheet" href="../node_modules/mocha/mocha.css">
  <style>
    
  </style>
  <script src="../node_modules/mocha/mocha.js"></script>
  <script src="../node_modules/chai/chai.js"></script>
  <script>mocha.setup('bdd')</script>
</head>
<body>
  <iframe id="basicsFrame" src="./basics/index.html"></iframe>
  <div id="mocha"></div>
  <script type="module">
    const assert = chai.assert;

    describe('Basics', function(){
      let win;
      let doc;
      let docEl;

      before(function(done) {
        setTimeout(() => {
          win = basicsFrame.contentWindow;
          doc = basicsFrame.contentDocument;
          docEl = doc.documentElement;
          done();
        }, 300);
      });

      it('Renders the initial page', function(){
        let el = doc.querySelector('basic-app');
        let div = el.shadowRoot.querySelector('#root');
        let txt = div.firstChild.nodeValue.trim();
        assert.equal(txt, 'Hello world!');
      });

      it('Renders subelements using the constructor', function(){
        let el = doc.querySelector('basic-app');
        let nested = el.shadowRoot.querySelector('another-el');
        assert.ok(nested, 'The nested element was rendered');

        let inner = nested.shadowRoot.firstElementChild;
        assert.equal(inner.textContent, 'Another el');
      });

      it('Renders elements that uses numbers', function(){
        let el = doc.querySelector('basic-app');
        let mathel = el.shadowRoot.querySelector('math-el');
        let inner = mathel.shadowRoot.firstElementChild;
        assert.equal(inner.textContent, '15 of 15');
      });

      it('renders svg', function(){
        let el = doc.querySelector('basic-app');
        let loading = el.shadowRoot.querySelector('loading-indicator');
        let svg = loading.shadowRoot.firstElementChild;
        assert.ok(svg.hasAttribute('viewBox'), 'has the viewBox');
      });

      it('renders children that are numbers', function(){
        let root = doc.querySelector('basic-app').shadowRoot;
        let el = root.querySelector('typed-el').shadowRoot;
        let val = el.querySelector('.c-number').textContent;
        assert.equal(val, '27', 'printed the string 27');
      });

      it('renders children that are booleans', function(){
        let root = doc.querySelector('basic-app').shadowRoot;
        let el = root.querySelector('typed-el').shadowRoot;
        let val = el.querySelector('.c-boolean').textContent;
        assert.equal(val, 'false', 'printed the string false');
      });

      it('renders fragments', function(){
        let root = doc.querySelector('basic-app').shadowRoot;
        let el = root.querySelector('frag-el').shadowRoot;

        assert.ok(el.querySelector('#one'), 'an element');
        assert.ok(el.querySelector('#two'), 'another el');
        assert.ok(el.querySelector('#three'), 'a nested fragment');
      });

      it('renders inner templates', function(){
        let root = doc.querySelector('basic-app').shadowRoot;
        let el = root.querySelector('#nested');
        assert.equal(el.textContent, 'This is nested');
      });
    });

    mocha.run();
  </script>
</body>
</html>
